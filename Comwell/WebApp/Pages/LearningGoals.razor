@page "/learninggoal/{Id:int}"
@inject HttpClient Http

@using Core.Models

<h3>Læringsmål</h3>

@if (resource == null)
{
        <p>Indlæser...</p>
}
else
{
        <h4>@resource.Title</h4>
        <p>@resource.Type</p>
        <p><a href="@resource.Url" target="_blank">Gå til ressource</a></p>

        @if (resource.Quiz != null)
        {
                <h5>Quiz</h5>
                <p><b>@resource.Quiz.Question</b></p>

                @for (int i = 0; i < resource.Quiz.Options.Count; i++)
                {
                        <button class="btn btn-primary m-1" @onclick="() => CheckAnswer(i)">
                                @resource.Quiz.Options[i]
                        </button>
                }

                @if (answerGiven)
                {
                        <p class="@resultClass">@resultText</p>
                }
        }
        else
        {
                <p>Ingen quiz tilknyttet.</p>
        }
}

@code {
        [Parameter]
        public int Id { get; set; }

        private LearningResource? resource;
        private bool answerGiven = false;
        private string resultText = "";
        private string resultClass = "";

        protected override async Task OnInitializedAsync()
        {
                resource = await Http.GetFromJsonAsync<LearningResource>($"api/learningresource/{Id}");
        }

        private void CheckAnswer(int selectedIndex)
        {
                answerGiven = true;

                if (resource!.Quiz.CorrectAnswerIndex == selectedIndex)
                {
                        resultText = "Korrekt!";
                        resultClass = "text-success";
                }
                else
                {
                        resultText = "Forkert. Prøv igen!";
                        resultClass = "text-danger";
                }
        }
}
